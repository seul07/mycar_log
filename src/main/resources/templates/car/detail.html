<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:lang="${#locale.language}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="|${car.manufacturer} ${car.modelName} - #{app.title}|">Car Detail</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
    <main class="container">
        <div class="page-header">
            <a th:href="@{/}" class="back-btn">&larr;</a>
            <h1 th:text="${car.manufacturer + ' ' + car.modelName}">Car Name</h1>
        </div>

        <div class="car-info-header">
            <div class="car-info-row">
                <span class="car-type-badge" th:classappend="${car.carType.name() == 'ELECTRIC'} ? 'electric' : 'gasoline'">
                    <span th:if="${car.carType.name() == 'ELECTRIC'}">&#9889; </span>
                    <span th:if="${car.carType.name() == 'GASOLINE'}">&#9981; </span>
                    <span th:text="${car.carType.name() == 'GASOLINE'} ? #{car.type.gasoline} : #{car.type.electric}">Type</span>
                </span>
                <span class="car-year" th:text="${car.modelYear + '년식'}">Year</span>
            </div>
        </div>

        <div class="calendar-section">
            <div class="calendar-header">
                <button type="button" class="btn-nav" onclick="changeMonth(-1)">&lt;</button>
                <h3 id="currentMonth"></h3>
                <button type="button" class="btn-nav" onclick="changeMonth(1)">&gt;</button>
            </div>

            <div class="calendar-grid">
                <div class="weekday" th:each="day : ${#strings.arraySplit('일,월,화,수,목,금,토', ',')}" th:text="${day}">Day</div>
            </div>
            <div id="calendarDays" class="calendar-days"></div>
        </div>
    </main>

    <nav class="bottom-nav" th:replace="~{fragments/nav :: nav}"></nav>

    <script th:inline="javascript">
        const hasCarData = true;
        const carId = [[${car.id}]];
        let expenseData = [[${monthlyExpenses}]] || {};
    </script>
    <script th:src="@{/js/app.js}"></script>
    <script th:inline="javascript">
        // Override goToDay for car-specific URL
        function goToDay(dateStr) {
            window.location.href = `/car/${carId}/expense/${dateStr}`;
        }

        // Override loadMonthlyExpenses for car-specific URL
        function loadMonthlyExpenses() {
            fetch(`/car/${carId}/calendar/${currentYear}/${currentMonth + 1}`)
                .then(response => response.json())
                .then(data => {
                    expenseData = data;
                    renderCalendar();
                })
                .catch(err => console.error('Failed to load expenses:', err));
        }
    </script>
</body>
</html>
