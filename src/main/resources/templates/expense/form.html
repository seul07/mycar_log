<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:lang="${#locale.language}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${isEdit} ? #{expense.edit} : #{expense.add}">Add Expense</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
    <header class="top-bar" th:replace="~{fragments/topbar :: topbar}"></header>
    <main class="container">
        <div class="page-header">
            <a th:href="${isEdit} ? @{'/car/' + ${carId} + '/expense/' + ${date}} : @{'/car/' + ${carId} + '/expense/' + ${date} + '/add'}" class="back-btn">&larr;</a>
            <h1>
                <span th:switch="${category.name()}">
                    <span th:case="'FUEL'" th:text="#{expense.category.fuel}">Fuel</span>
                    <span th:case="'MAINTENANCE'" th:text="#{expense.category.maintenance}">Maintenance</span>
                    <span th:case="'TAX'" th:text="#{expense.category.tax}">Tax</span>
                    <span th:case="'INSURANCE'" th:text="#{expense.category.insurance}">Insurance</span>
                    <span th:case="'PARKING'" th:text="#{expense.category.parking}">Parking</span>
                    <span th:case="'CAR_WASH'" th:text="#{expense.category.carwash}">Car Wash</span>
                    <span th:case="'OTHER'" th:text="#{expense.category.other}">Other</span>
                </span>
            </h1>
        </div>

        <div class="card">
            <form th:action="${isEdit} ? @{'/car/' + ${carId} + '/expense/' + ${expenseDto.id} + '/edit'} : @{'/car/' + ${carId} + '/expense/' + ${date} + '/add/' + ${category.name()}}"
                  method="post" th:object="${expenseDto}">
                <input type="hidden" th:field="*{id}" th:if="${isEdit}">
                <input type="hidden" th:field="*{expenseDate}">
                <input type="hidden" th:field="*{category}">

                <!-- FUEL -->
                <div th:if="${category.name() == 'FUEL'}">
                    <div class="form-group">
                        <label th:for="amount" th:text="#{expense.amount} + ' (원)'">Amount</label>
                        <input type="number" id="amount" th:field="*{amount}"
                               class="form-control" required min="0">
                    </div>
                    <div class="form-group">
                        <label th:for="pricePerLiter" th:text="#{fuel.pricePerLiter}">Price per Liter</label>
                        <input type="number" id="pricePerLiter" th:field="*{pricePerLiter}"
                               class="form-control" min="0" step="0.01">
                    </div>
                    <div class="form-group">
                        <label th:for="liters" th:text="#{fuel.liters}">Liters</label>
                        <input type="number" id="liters" th:field="*{liters}"
                               class="form-control" min="0" step="0.01">
                    </div>
                </div>

                <!-- MAINTENANCE -->
                <div th:if="${category.name() == 'MAINTENANCE'}">
                    <div class="form-group">
                        <label th:for="maintenanceItemId" th:text="#{maintenance.select}">Maintenance Item</label>
                        <select id="maintenanceItemId" th:field="*{maintenanceItemId}" class="form-control" required>
                            <option value="">-- Select --</option>
                            <option th:each="item : ${maintenanceItems}"
                                    th:value="${item.id}"
                                    th:text="${item.title}">Item</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label th:for="amount" th:text="#{expense.amount} + ' (원)'">Amount</label>
                        <input type="number" id="amount" th:field="*{amount}"
                               class="form-control" required min="0">
                    </div>
                </div>

                <!-- INSURANCE -->
                <div th:if="${category.name() == 'INSURANCE'}">
                    <div class="form-group">
                        <label th:for="insuranceType" th:text="#{insurance.type}">Insurance Type</label>
                        <select id="insuranceType" th:field="*{insuranceType}" class="form-control" required>
                            <option value="">-- Select --</option>
                            <option value="car" th:text="#{insurance.type.car}">Car Insurance</option>
                            <option value="driver" th:text="#{insurance.type.driver}">Driver Insurance</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label th:for="amount" th:text="#{expense.amount} + ' (원)'">Amount</label>
                        <input type="number" id="amount" th:field="*{amount}"
                               class="form-control" required min="0">
                    </div>
                </div>

                <!-- TAX, PARKING, CAR_WASH, OTHER -->
                <div th:if="${category.name() == 'TAX' || category.name() == 'PARKING' || category.name() == 'CAR_WASH' || category.name() == 'OTHER'}">
                    <div class="form-group">
                        <label th:for="amount" th:text="#{expense.amount} + ' (원)'">Amount</label>
                        <input type="number" id="amount" th:field="*{amount}"
                               class="form-control" required min="0">
                    </div>
                </div>

                <!-- Description -->
                <div class="form-group">
                    <label th:for="description" th:text="#{expense.description}">Memo</label>
                    <input type="text" id="description" th:field="*{description}"
                           class="form-control">
                </div>

                <div class="form-group mt-3">
                    <button type="submit" class="btn btn-primary" style="width: 100%;"
                            th:text="#{action.save}">Save</button>
                </div>
            </form>

            <form th:if="${isEdit}" th:action="@{'/car/' + ${carId} + '/expense/' + ${expenseDto.id} + '/delete'}"
                  method="post" style="margin-top: 1rem;">
                <button type="submit" class="btn btn-danger" style="width: 100%;"
                        onclick="return confirm('Delete this expense?');"
                        th:text="#{action.delete}">Delete</button>
            </form>
        </div>
    </main>

    <nav class="bottom-nav" th:replace="~{fragments/nav :: nav}"></nav>
    <script th:src="@{/js/app.js}"></script>
</body>
</html>
